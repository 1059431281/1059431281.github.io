(window.webpackJsonp=window.webpackJsonp||[]).push([[49],{417:function(a,l,e){"use strict";e.r(l);var v=e(11),_=Object(v.a)({},(function(){var a=this,l=a._self._c;return l("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[l("h2",{attrs:{id:"提问-webpack的构建流程"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#提问-webpack的构建流程"}},[a._v("#")]),a._v(" 提问：webpack的构建流程")]),a._v(" "),l("p",[a._v("解析：我境界不足不知道他考点是什么（因为我还是个初级前端菜鸟），可能就是考验你懂不懂这些，在实际中或许会有需要用到的地方")]),a._v(" "),l("p",[l("strong",[a._v("答案1：")])]),a._v(" "),l("p",[a._v("webpack启动之后会读取命令行的配置项和配置文件的配置项，接着从entry开始，递归解析entry所依赖的module，根据配置找到module对应的loader进行相应的处理转换，对module转换后则进行解析，解析的成果是一个个chunk，最后将所有chunk转换成文件输出的output")]),a._v(" "),l("p",[a._v("在整个构建过程中，webpack会在恰当的时机执行plugin。")]),a._v(" "),l("p",[l("strong",[a._v("答案2：")])]),a._v(" "),l("p",[a._v("每种答案都可以，就看能理解哪个就说哪一个。")]),a._v(" "),l("ol",[l("li",[a._v("检查是否有安装官方脚手架，如没有则提示安装，如果不止一个脚手架则提示要删除一个")]),a._v(" "),l("li",[a._v("初始化参数，从命令行和配置文件读取和合并参数得出最终参数（命令行优先）。")]),a._v(" "),l("li",[a._v("初始化compiler对象，加载所有配置的插件，将他们挂载到comiler对象上")]),a._v(" "),l("li",[a._v("根据配置的entry找出所有入口文件。")]),a._v(" "),l("li",[a._v("从入口文件出发，对文件中的模块使用相应的loader进行解析（翻译），然后再找出该模块依赖的模块加入到依赖数组，如此递归直到所有入口依赖文件都经过处理。")]),a._v(" "),l("li",[a._v("完成模块编译工作，我们得知了每个模块所持有的内容以及依赖关系。")]),a._v(" "),l("li",[a._v("根据入口和模块之间的依赖关系，组成一个个包含多个模块的chunk，再把每个chunk转换成单独的文件加入输出列表。")]),a._v(" "),l("li",[a._v("得到输出列表就等于决定了输出内容，这时候再根据配置文件的路径和文件名把内容写进去就好。")]),a._v(" "),l("li",[a._v("webpack会在以上过程中再特定时间发出广播事件去监听需要用到插件的地方进行功能拓展，并调用webpack提供的api改变webpack的运行结果")])]),a._v(" "),l("h2",{attrs:{id:"提问-webpack常用的loader和plugin"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#提问-webpack常用的loader和plugin"}},[a._v("#")]),a._v(" 提问：webpack常用的loader和plugin")]),a._v(" "),l("p",[a._v("解析：考验你是否有真的学过webpack，因为学过的话肯定会知道一两个loader和plugin的，虽然现在脚手架基本替我们搞定了。")]),a._v(" "),l("p",[l("strong",[a._v("答案:")])]),a._v(" "),l("h3",{attrs:{id:"常用loader"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#常用loader"}},[a._v("#")]),a._v(" 常用loader：")]),a._v(" "),l("ul",[l("li",[a._v("file-loader（让webpack能处理文件）")]),a._v(" "),l("li",[a._v("url-loader（内置file-loader，并且能将文件转换为base64，缺点是只能处理图片和字体文件）")]),a._v(" "),l("li",[a._v("source-map-loader（加载额外的map文件，便于我们调试，但代码量会比不加载要多）")]),a._v(" "),l("li",[a._v("Image-loader（压缩图片文件）")]),a._v(" "),l("li",[a._v("babel-loader（最为核心的loader，将es6代码转换为es5）")]),a._v(" "),l("li",[a._v("ts-loader（将ts转换为js）")]),a._v(" "),l("li",[a._v("Awesome-typescript-loader（ts-loader的升级版）")]),a._v(" "),l("li",[a._v("sass-loader")]),a._v(" "),l("li",[a._v("css-loader（加载css，支持模块化/压缩/导入）")]),a._v(" "),l("li",[a._v("style-loader（将css代码注入到javascript中）")]),a._v(" "),l("li",[a._v("postcss-loader（自动加上兼容前缀，和autoprefixer插件配合使用）")]),a._v(" "),l("li",[a._v("eslint-loader（通过eslint检测js代码，有错会在页面进行警告）")]),a._v(" "),l("li",[a._v("tslint-loader（几乎同上）")]),a._v(" "),l("li",[a._v("vue-loader（加载vue文件）")]),a._v(" "),l("li",[a._v("less-loader")]),a._v(" "),l("li",[a._v("html-loader")])]),a._v(" "),l("h3",{attrs:{id:"不常用loader"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#不常用loader"}},[a._v("#")]),a._v(" 不常用loader：")]),a._v(" "),l("ul",[l("li",[a._v("raw-loader（加载文件的原始内容，一般我们导入文件获取到的是对象，使用方式为!!raw-loader!文件路径）")]),a._v(" "),l("li",[a._v("Svg-inline-loader（将压缩后的svg内容注入代码）")]),a._v(" "),l("li",[a._v("Json-loader（能加载json文件，webpack默认包含）")]),a._v(" "),l("li",[a._v("mocha-loader（这个我只是听说但没真的用过，加载mocha测试用例代码的）")]),a._v(" "),l("li",[a._v("cache-loader（将loader进行缓存到磁盘）")]),a._v(" "),l("li",[a._v("I18n-loader（国际化）")])]),a._v(" "),l("h3",{attrs:{id:"常用plugin"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#常用plugin"}},[a._v("#")]),a._v(" 常用plugin：")]),a._v(" "),l("ul",[l("li",[a._v("html-webpack-plugin（和html-loader相辅相成，简化html文件创建）")]),a._v(" "),l("li",[a._v("web-webpack-plugin（html-webpack-plugin升级版）")]),a._v(" "),l("li",[a._v("webpack-parallel-uglify-plugin（多进程执行代码压缩，提供构建速度）")]),a._v(" "),l("li",[a._v("mini-css-extract-plugin（分离样式文件）")]),a._v(" "),l("li",[a._v("speed-measure-webpack-plugin（可以看到每个plugin和loader的耗时）")]),a._v(" "),l("li",[a._v("webpack-bundle-analyzer（可视化webpack输出文件）")]),a._v(" "),l("li",[a._v("webpack- dashboard（展示相关打包信息）")]),a._v(" "),l("li",[a._v("wepback-merge提取公共配置，减少重复配置")]),a._v(" "),l("li",[a._v("size-plugin（监控资源体积变化）")]),a._v(" "),l("li",[a._v("hotmoduleReplacementplugin（模块热更新）")])]),a._v(" "),l("h3",{attrs:{id:"不常用plugin"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#不常用plugin"}},[a._v("#")]),a._v(" 不常用plugin：")]),a._v(" "),l("ul",[l("li",[a._v("define-plugin（定义全局环境变量，但现在几乎不用，因为指定mode后可以自己对应的配置文件里面添加）")]),a._v(" "),l("li",[a._v("ignore-plugin（没用过，忽略部分文件用的）")])]),a._v(" "),l("h2",{attrs:{id:"loader和plugin的区别"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#loader和plugin的区别"}},[a._v("#")]),a._v(" loader和plugin的区别")]),a._v(" "),l("h3",{attrs:{id:"loader"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#loader"}},[a._v("#")]),a._v(" loader")]),a._v(" "),l("p",[a._v("loader本质就是一个函数，对接收的内容进行处理，将内容转换成webpack能认识的js，也就是预处理工作")]),a._v(" "),l("h3",{attrs:{id:"plugin"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#plugin"}},[a._v("#")]),a._v(" plugin")]),a._v(" "),l("p",[a._v("基于事件流框架tapable，用来扩展webpack的功能，在运行时广播出许多事件，plugin监听到这些事件后就会在合适的时机通过webpack提供的api改变输出结果")]),a._v(" "),l("h3",{attrs:{id:"总结"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[a._v("#")]),a._v(" 总结")]),a._v(" "),l("p",[a._v("loader是解析规则，写在module.rules中，值为数组对象，对象中包含类型文件，loader，options等属性")]),a._v(" "),l("p",[a._v("plugin是功能扩展，写在plugins中，类型为数组，每一项都是plugin的实例，参数通过构造函数传入")]),a._v(" "),l("h2",{attrs:{id:"模块打包原理"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#模块打包原理"}},[a._v("#")]),a._v(" 模块打包原理")]),a._v(" "),l("p",[a._v("webpack为每个模块创造一个可以导出和导入的环境（将import改为require），本质上没有修改任何的代码逻辑，执行顺序和模块加载顺序没变")]),a._v(" "),l("h2",{attrs:{id:"文件监听原理"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#文件监听原理"}},[a._v("#")]),a._v(" 文件监听原理")]),a._v(" "),l("p",[a._v("webpack开启监听陌生的方式有两种，一种是webpack命令行加上--watch，一种是在配置文件加上watch：true")]),a._v(" "),l("p",[a._v("开启之后，webpack会在每次源码发生变化时构建出新的输出文件，但构建新文件这一步不会马上执行，而是在会将改变缓存起来，等aggreagetime设置的时间到后执行")]),a._v(" "),l("p",[a._v("有了新文件也不会刷新页面，需要我们手动刷新")]),a._v(" "),l("h2",{attrs:{id:"热更新原理-hmr"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#热更新原理-hmr"}},[a._v("#")]),a._v(" 热更新原理（HMR）")]),a._v(" "),l("p",[a._v("我们上面提到的手动刷新问题就是通过热更新机制来解决，这里用大白话的方式简单说下。")]),a._v(" "),l("p",[a._v("hmr的核心是客户端从服务端拉来更新后的文件，而实现这一步的是webpack-dev-server（简称为wds）与客服端建立起websocket，当本地资源发生变化的时候（文件系统检测）wds就会向浏览器推送更新，并带上构建的hash，客户端会对资源进行新旧比较。客户端发现差异后wds会发起ajax请求获取更改内容（是一个json），该josn包含了所有要更新的hash值，客户端就可以通过这些信息发起jsonp请求获取chunk的增量更新，也就是最新的模块代码，获取增量更新后就由hostmoduleplugin去决定如何处理如何保留如何更新。")]),a._v(" "),l("h2",{attrs:{id:"配置文件的占位符"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#配置文件的占位符"}},[a._v("#")]),a._v(" 配置文件的占位符")]),a._v(" "),l("ul",[l("li",[a._v("hash 随机hash值，只要项目文件有修改就会被")]),a._v(" "),l("li",[a._v("chunkhash 与webpack打包的chunk有关")]),a._v(" "),l("li",[a._v("contenthash 根据文件来生成的hash")]),a._v(" "),l("li",[a._v("ext 资源后缀")]),a._v(" "),l("li",[a._v("name 文件名")]),a._v(" "),l("li",[a._v("path 文件相对路径")]),a._v(" "),l("li",[a._v("folder 文件所在文件夹")]),a._v(" "),l("li",[a._v("Emoji 随机的指代文件的emoji")])]),a._v(" "),l("h2",{attrs:{id:"如何提高webpack构建速度"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#如何提高webpack构建速度"}},[a._v("#")]),a._v(" 如何提高webpack构建速度")]),a._v(" "),l("p",[a._v("跟如何提升页面性能是同级别的问题，有必要好好记忆。")]),a._v(" "),l("ol",[l("li",[a._v("使用高版本的webpack和node")]),a._v(" "),l("li",[a._v("多进程构建（thread-loader）")]),a._v(" "),l("li",[a._v("压缩代码\n"),l("ol",[l("li",[a._v("webpack-parallel-uglify-plugin（多进程压缩）")]),a._v(" "),l("li",[a._v("uglifyjs-webpack-plugin 开启 parallel 参数 (被上面的淘汰了)")]),a._v(" "),l("li",[a._v("terser-webpack-plugin 开启 parallel 参数")]),a._v(" "),l("li",[a._v("css-loader开启minimize开启cssnano压缩css")])])]),a._v(" "),l("li",[a._v("图片压缩\n"),l("ol",[l("li",[a._v("iamge-webpack-loader")]),a._v(" "),l("li",[a._v("url-loader")])])]),a._v(" "),l("li",[a._v("缩小打包作用域\n"),l("ol",[l("li",[a._v("exclude/include")]),a._v(" "),l("li",[a._v("resolve.modules指明第三方模块绝对路径，减少不必要查找")]),a._v(" "),l("li",[a._v("resolve.extensions减少后缀的尝试")]),a._v(" "),l("li",[a._v("noparse忽略不需要解析的库")]),a._v(" "),l("li",[a._v("合理使用alias")]),a._v(" "),l("li",[a._v("ignoreplugin忽略不需要的模块")])])]),a._v(" "),l("li",[a._v("提取公共资源\n"),l("ol",[l("li",[a._v("html-webpack-externals-plugin将基础包通过cdn引入")]),a._v(" "),l("li",[a._v("splitechunksplugin")])])]),a._v(" "),l("li",[a._v("利用缓存")]),a._v(" "),l("li",[a._v("清除没有引用过的模块")]),a._v(" "),l("li",[a._v("构建的代码有大量闭包，通过scope hostiing将所有痛苦按引用顺序放在一个函数作用域里面，并进行必要的重命名防止命名冲突")]),a._v(" "),l("li",[a._v("动态polyfill（就是动态的实现浏览器兼容，而不是一次性全给出）")])]),a._v(" "),l("p",[a._v("参考文献：https://juejin.cn/post/6844904094281236487")])])}),[],!1,null,null,null);l.default=_.exports}}]);