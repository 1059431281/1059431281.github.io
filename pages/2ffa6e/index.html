<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>微前端--基本使用篇 | ゆらぎ荘の幽奈さん</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="./img/d.png">
    <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
    <meta name="description" content="web前端技术博客,简洁至上,专注web前端学习与总结。JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github等技术文章。">
    <meta name="keywords" content="前端博客,个人技术博客,前端,前端开发,前端框架,web前端,前端面试题,技术文档,学习,面试,JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github,markdown">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    <link rel="preload" href="/assets/css/0.styles.7dbce163.css" as="style"><link rel="preload" href="/assets/js/app.7f8612d2.js" as="script"><link rel="preload" href="/assets/js/2.8f62c2a0.js" as="script"><link rel="preload" href="/assets/js/3.fbc0c9b3.js" as="script"><link rel="preload" href="/assets/js/41.1fab0bad.js" as="script"><link rel="prefetch" href="/assets/js/10.1f130a2c.js"><link rel="prefetch" href="/assets/js/11.e3694241.js"><link rel="prefetch" href="/assets/js/12.0b9a835a.js"><link rel="prefetch" href="/assets/js/13.6778eb7e.js"><link rel="prefetch" href="/assets/js/14.06713df5.js"><link rel="prefetch" href="/assets/js/15.f4449fb4.js"><link rel="prefetch" href="/assets/js/16.bd5c1114.js"><link rel="prefetch" href="/assets/js/17.939992ac.js"><link rel="prefetch" href="/assets/js/18.c5954949.js"><link rel="prefetch" href="/assets/js/19.dbf8c765.js"><link rel="prefetch" href="/assets/js/20.356e6d7c.js"><link rel="prefetch" href="/assets/js/21.558c3070.js"><link rel="prefetch" href="/assets/js/22.3fbdcb5c.js"><link rel="prefetch" href="/assets/js/23.531a7ec9.js"><link rel="prefetch" href="/assets/js/24.8f2bc73e.js"><link rel="prefetch" href="/assets/js/25.4219b0a2.js"><link rel="prefetch" href="/assets/js/26.b040eeb8.js"><link rel="prefetch" href="/assets/js/27.d41d8aba.js"><link rel="prefetch" href="/assets/js/28.8ccb862a.js"><link rel="prefetch" href="/assets/js/29.1c8156f7.js"><link rel="prefetch" href="/assets/js/30.ad92e326.js"><link rel="prefetch" href="/assets/js/31.45fd3f33.js"><link rel="prefetch" href="/assets/js/32.12d97258.js"><link rel="prefetch" href="/assets/js/33.d6cc4daa.js"><link rel="prefetch" href="/assets/js/34.91175e8a.js"><link rel="prefetch" href="/assets/js/35.4433b12f.js"><link rel="prefetch" href="/assets/js/36.432cd2ab.js"><link rel="prefetch" href="/assets/js/37.63c25ba8.js"><link rel="prefetch" href="/assets/js/38.53a294b6.js"><link rel="prefetch" href="/assets/js/39.2de4e783.js"><link rel="prefetch" href="/assets/js/4.334b66ba.js"><link rel="prefetch" href="/assets/js/40.246fd4f0.js"><link rel="prefetch" href="/assets/js/42.7c629bd0.js"><link rel="prefetch" href="/assets/js/43.fdbbd2a0.js"><link rel="prefetch" href="/assets/js/44.240c5a96.js"><link rel="prefetch" href="/assets/js/45.b67d1371.js"><link rel="prefetch" href="/assets/js/46.617ce187.js"><link rel="prefetch" href="/assets/js/47.59146731.js"><link rel="prefetch" href="/assets/js/48.851f279f.js"><link rel="prefetch" href="/assets/js/49.904b85c2.js"><link rel="prefetch" href="/assets/js/5.f8936771.js"><link rel="prefetch" href="/assets/js/50.64364341.js"><link rel="prefetch" href="/assets/js/51.b4102e42.js"><link rel="prefetch" href="/assets/js/52.c9ee9a7a.js"><link rel="prefetch" href="/assets/js/53.6945268f.js"><link rel="prefetch" href="/assets/js/54.56bd96b0.js"><link rel="prefetch" href="/assets/js/55.b2a8fc28.js"><link rel="prefetch" href="/assets/js/56.a7aa1640.js"><link rel="prefetch" href="/assets/js/57.40d8e0e5.js"><link rel="prefetch" href="/assets/js/58.207ab2cc.js"><link rel="prefetch" href="/assets/js/59.a6ab4b5c.js"><link rel="prefetch" href="/assets/js/6.a1d56fe1.js"><link rel="prefetch" href="/assets/js/60.d25454ad.js"><link rel="prefetch" href="/assets/js/61.7ed8db18.js"><link rel="prefetch" href="/assets/js/62.cad3d04d.js"><link rel="prefetch" href="/assets/js/63.8be61101.js"><link rel="prefetch" href="/assets/js/64.7b24da96.js"><link rel="prefetch" href="/assets/js/65.88663a4a.js"><link rel="prefetch" href="/assets/js/66.d43f717a.js"><link rel="prefetch" href="/assets/js/67.2a8ff76b.js"><link rel="prefetch" href="/assets/js/68.5a871cc3.js"><link rel="prefetch" href="/assets/js/69.ada21f6d.js"><link rel="prefetch" href="/assets/js/7.c6f1828d.js"><link rel="prefetch" href="/assets/js/70.5f5f5a22.js"><link rel="prefetch" href="/assets/js/71.f3186b4f.js"><link rel="prefetch" href="/assets/js/72.89ac627d.js"><link rel="prefetch" href="/assets/js/73.246a602c.js"><link rel="prefetch" href="/assets/js/74.794d450f.js"><link rel="prefetch" href="/assets/js/75.452de7c3.js"><link rel="prefetch" href="/assets/js/8.8985d848.js"><link rel="prefetch" href="/assets/js/9.68346b58.js">
    <link rel="stylesheet" href="/assets/css/0.styles.7dbce163.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu have-body-img"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><span class="site-name can-hide">ゆらぎ荘の幽奈さん</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/archives/" class="nav-link">归档</a></div> <a href="https://github.com/1059431281" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://cdn.jsdelivr.net/gh/1059431281/Blog-source/img/custom/avatar.png"> <div class="blogger-info"><h3>雨宿り</h3> <span>ゆらぎ荘の幽奈さん</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/archives/" class="nav-link">归档</a></div> <a href="https://github.com/1059431281" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/pages/9552d4/" class="sidebar-link">ajax基础</a></li><li><a href="/pages/bc9688/" class="sidebar-link">web前端面试汇总</a></li><li><a href="/pages/9177a7/" class="sidebar-link">视频代码规范</a></li><li><a href="/pages/5fd934/" class="sidebar-link">svg 文字使用（兼容 IE）</a></li><li><a href="/pages/dcfca9/" class="sidebar-link">async与await详解</a></li><li><a href="/pages/f04a87/" class="sidebar-link">简单说下vuex的实现</a></li><li><a href="/pages/eb21c5/" class="sidebar-link">大白话copmputed和watch</a></li><li><a href="/pages/5234cd/" class="sidebar-link">keep-alive实现原理</a></li><li><a href="/pages/b6d702/" class="sidebar-link">一些前端面试回答</a></li><li><a href="/pages/f70dfe/" class="sidebar-link">大白话vue响应式原理和双向绑定（记录用，不建议阅读）</a></li><li><a href="/pages/c42d20/" class="sidebar-link">大白话diff算法</a></li><li><a href="/pages/5b44a2/" class="sidebar-link">大白话vue-router</a></li><li><a href="/pages/8bb637/" class="sidebar-link">ts学习总结--基础篇</a></li><li><a href="/pages/99c217/" class="sidebar-link">ts学习总结——实际篇</a></li><li><a href="/pages/9a928a/" class="sidebar-link">antd和element基础篇</a></li><li><a href="/pages/08fa3b/" class="sidebar-link">vue3虚拟dom和diff算法</a></li><li><a href="/pages/417bb6/" class="sidebar-link">webpack常用插件使用</a></li><li><a href="/pages/2ffa6e/" aria-current="page" class="active sidebar-link">微前端--基本使用篇</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/2ffa6e/#前言" class="sidebar-link">前言</a></li><li class="sidebar-sub-header"><a href="/pages/2ffa6e/#为什么需要微前端" class="sidebar-link">为什么需要微前端？</a></li><li class="sidebar-sub-header"><a href="/pages/2ffa6e/#微前端应用有哪些" class="sidebar-link">微前端应用有哪些？</a></li><li class="sidebar-sub-header"><a href="/pages/2ffa6e/#iframe" class="sidebar-link">iframe</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/2ffa6e/#优点" class="sidebar-link">优点</a></li><li class="sidebar-sub-header"><a href="/pages/2ffa6e/#缺点" class="sidebar-link">缺点</a></li><li class="sidebar-sub-header"><a href="/pages/2ffa6e/#科普" class="sidebar-link">科普</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/2ffa6e/#single-spa" class="sidebar-link">single-spa</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/2ffa6e/#优点-2" class="sidebar-link">优点</a></li><li class="sidebar-sub-header"><a href="/pages/2ffa6e/#缺点-2" class="sidebar-link">缺点</a></li><li class="sidebar-sub-header"><a href="/pages/2ffa6e/#前言-2" class="sidebar-link">前言</a></li><li class="sidebar-sub-header"><a href="/pages/2ffa6e/#子应用构建" class="sidebar-link">子应用构建</a></li><li class="sidebar-sub-header"><a href="/pages/2ffa6e/#主应用构建" class="sidebar-link">主应用构建</a></li><li class="sidebar-sub-header"><a href="/pages/2ffa6e/#如何实现css隔离" class="sidebar-link">如何实现css隔离</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/2ffa6e/#qiankun" class="sidebar-link">qiankun</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/2ffa6e/#优点-3" class="sidebar-link">优点</a></li><li class="sidebar-sub-header"><a href="/pages/2ffa6e/#缺点-5" class="sidebar-link">缺点</a></li><li class="sidebar-sub-header"><a href="/pages/2ffa6e/#子应用构建-2" class="sidebar-link">子应用构建</a></li><li class="sidebar-sub-header"><a href="/pages/2ffa6e/#主应用构建-2" class="sidebar-link">主应用构建</a></li><li class="sidebar-sub-header"><a href="/pages/2ffa6e/#setdefaultmountapp" class="sidebar-link">setDefaultMountApp</a></li><li class="sidebar-sub-header"><a href="/pages/2ffa6e/#initglobalstate" class="sidebar-link">initGlobalState</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/2ffa6e/#micro-app" class="sidebar-link">micro-app</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/2ffa6e/#优点-4" class="sidebar-link">优点</a></li><li class="sidebar-sub-header"><a href="/pages/2ffa6e/#缺点-6" class="sidebar-link">缺点</a></li><li class="sidebar-sub-header"><a href="/pages/2ffa6e/#主应用构建-3" class="sidebar-link">主应用构建</a></li><li class="sidebar-sub-header"><a href="/pages/2ffa6e/#子应用构建-3" class="sidebar-link">子应用构建</a></li><li class="sidebar-sub-header"><a href="/pages/2ffa6e/#数据通信" class="sidebar-link">数据通信</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/2ffa6e/#无界" class="sidebar-link">无界</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/2ffa6e/#优点-5" class="sidebar-link">优点</a></li><li class="sidebar-sub-header"><a href="/pages/2ffa6e/#核心方案" class="sidebar-link">核心方案</a></li><li class="sidebar-sub-header"><a href="/pages/2ffa6e/#前言-3" class="sidebar-link">前言</a></li><li class="sidebar-sub-header"><a href="/pages/2ffa6e/#主应用构建-4" class="sidebar-link">主应用构建</a></li><li class="sidebar-sub-header"><a href="/pages/2ffa6e/#子应用构建-4" class="sidebar-link">子应用构建</a></li><li class="sidebar-sub-header"><a href="/pages/2ffa6e/#关于wujie对框架的封装" class="sidebar-link">关于wujie对框架的封装</a></li><li class="sidebar-sub-header"><a href="/pages/2ffa6e/#路由同步" class="sidebar-link">路由同步</a></li><li class="sidebar-sub-header"><a href="/pages/2ffa6e/#在子应用上的键" class="sidebar-link">在子应用上的键</a></li><li class="sidebar-sub-header"><a href="/pages/2ffa6e/#生命周期" class="sidebar-link">生命周期</a></li><li class="sidebar-sub-header"><a href="/pages/2ffa6e/#通信" class="sidebar-link">通信</a></li><li class="sidebar-sub-header"><a href="/pages/2ffa6e/#setupapp" class="sidebar-link">setupApp</a></li></ul></li></ul></li><li><a href="/pages/058b54/" class="sidebar-link">小程序小知识</a></li><li><a href="/pages/e2b592/" class="sidebar-link">canvas常用场景</a></li><li><a href="/pages/3a4661/" class="sidebar-link">Promise篇</a></li><li><a href="/pages/1c97e3/" class="sidebar-link">浏览器兼容性篇</a></li><li><a href="/pages/88d05c/" class="sidebar-link">组件函数指令生成器1.0</a></li><li><a href="/pages/a9a7ea/" class="sidebar-link">组件函数指令生成器2.0</a></li><li><a href="/pages/85995a/" class="sidebar-link">vite一点学习知识</a></li><li><a href="/pages/a4609b/" class="sidebar-link">webpack基础知识记录</a></li></ul> <div class="sidebar-slot sidebar-slot-bottom"><!-- 正方形 -->
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="3508773082"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div></aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-583ea4e9><div class="articleInfo" data-v-583ea4e9><ul class="breadcrumbs" data-v-583ea4e9><li data-v-583ea4e9><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-583ea4e9></a></li> <li data-v-583ea4e9><a href="/categories/?category=web%E5%89%8D%E7%AB%AF" title="分类" data-v-583ea4e9>web前端</a></li> <!----> <!----></ul> <div class="info" data-v-583ea4e9><div title="作者" class="author iconfont icon-touxiang" data-v-583ea4e9><a href="https://github.com/1059431281" target="_blank" title="作者" class="beLink" data-v-583ea4e9>yusu</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-583ea4e9><a href="javascript:;" data-v-583ea4e9>2023-01-04</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">
          微前端--基本使用篇
        </h1> <div class="page-slot page-slot-top"><!-- 固定100% * 90px可显示，max-height:90px未见显示-->
     <ins class="adsbygoogle"
          style="display:inline-block;width:100%;max-height:90px"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="6625304284"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div> <div class="theme-vdoing-content content__default"><h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <p>本文讲的是使用，而不是框架们的构成和原理，可以期待下一篇原理篇，但计划表中排的比较后。</p> <h2 id="为什么需要微前端"><a href="#为什么需要微前端" class="header-anchor">#</a> 为什么需要微前端？</h2> <p>最初出现微前端的原因，是随着前端项目越发复杂、庞大，状态混乱等，这会导致项目难以为续，bug越多、维护困难，新增功能等等问题。</p> <p>简单理解，就是解决单体应用在一个偏长的时间跨度下，由于团队人员逐渐增多或变迁，从一个普通应用演变成一个巨石应用，随之而来的应用不可维护问题。</p> <p>总结一下就是，不同开发团队间的技术栈不同，希望团队可以独立开发，独立部署，旧代码暂不可遗弃。</p> <p>这种情况下，微前端就是将不同的功能按照不同的维度拆分成多个子应用，通过主应用来加载这些子应用。</p> <h2 id="微前端应用有哪些"><a href="#微前端应用有哪些" class="header-anchor">#</a> 微前端应用有哪些？</h2> <p>按照时间来理解的话，可以是这样：</p> <p><strong>iframe</strong></p> <p><strong>无界</strong>  ⬅️  ⬇️   ➡️  <strong>microApp</strong></p> <p><strong>single-spa</strong></p> <p>⬇️</p> <p><strong>qiankun</strong></p> <p>平常的话，mircro-app和qiankun可以选择使用，single-spa不推荐，iframe可以用在一些干脆简单的，最好是会占屏幕大部分</p> <h2 id="iframe"><a href="#iframe" class="header-anchor">#</a> iframe</h2> <h3 id="优点"><a href="#优点" class="header-anchor">#</a> 优点</h3> <p>提供了浏览器原生的硬隔离方案，不论是样式、js这类都被完全隔离，不会与其他应用相互影响。</p> <h3 id="缺点"><a href="#缺点" class="header-anchor">#</a> 缺点</h3> <ol><li>url不同步。浏览器刷新，iframe内跳转的状态丢失，并且没有前进后退操作。</li> <li>UI不同步，DOM结构不共享。iframe内的一直元素都是基于它自己，而不是基于所处应用。经典例子就是iframe内的弹窗，正常这些弹窗是显示在主应用中间，随resize改变而改变，但没办法，他们不共享ui，只会显示在iframe内的中间。</li> <li>全局上下文完全隔离，内存变量不共享。iframe 内外系统的通信、数据同步等需求，主应用的 cookie 要透传到根域名都不同的子应用中实现免登效果。</li> <li>慢。每次子应用进入都要经历浏览器上下文重建，资源重新加载的过程。</li></ol> <h3 id="科普"><a href="#科普" class="header-anchor">#</a> 科普</h3> <p>要实现数据通讯，方法有<code>postMessage</code>，或者如果是同源的话，可以直接通过访问window去读取全局变量。</p> <p>至于上面所说的免登效果，可以将SameSite设为None，避免同源限制。同时，设置Secure，近允许在https环境中可用。</p> <p>另外要注意的是，设置Secure后，http和https协议的cookie不能互通。</p> <p>服务端</p> <h4 id="客户端设置"><a href="#客户端设置" class="header-anchor">#</a> 客户端设置</h4> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>document<span class="token punctuation">.</span>cookit <span class="token operator">=</span> <span class="token string">&quot;key=value;SameSite=None;Secure&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="nginx代理"><a href="#nginx代理" class="header-anchor">#</a> nginx代理</h4> <p>共享cookie还有一个方法，不过我不熟，就是利用反向代理，把我们的主域名改成一直。</p> <h2 id="single-spa"><a href="#single-spa" class="header-anchor">#</a> single-spa</h2> <h3 id="优点-2"><a href="#优点-2" class="header-anchor">#</a> 优点</h3> <ol><li>纯前端技术实现</li> <li>完善的生态</li> <li>简单的通信</li></ol> <h3 id="缺点-2"><a href="#缺点-2" class="header-anchor">#</a> 缺点</h3> <ol><li>上手成本高</li> <li>需要改造现有应用</li> <li>样式隔离需要单独处理</li></ol> <h3 id="前言-2"><a href="#前言-2" class="header-anchor">#</a> 前言</h3> <p>下面的使用会以最全面的写法去进行，不会特别一步步去引导，但会做好注释。</p> <p>正常来说，我们先构建好子应用，然后才去主应用注册子应用，所以接下来会先构建子应用。</p> <h3 id="子应用构建"><a href="#子应用构建" class="header-anchor">#</a> 子应用构建</h3> <p>基于vue2</p> <h4 id="第一步"><a href="#第一步" class="header-anchor">#</a> 第一步</h4> <p>针对项目的技术栈，我们创建对应的<code>single-spa</code>，比如说，我们要用vue，那我们就按照一个<code>single-spa-vue</code></p> <h4 id="第二步"><a href="#第二步" class="header-anchor">#</a> 第二步</h4> <p>在入口文件进行配置。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// main.js</span>

<span class="token keyword">import</span> SingleSpaVue <span class="token keyword">from</span> <span class="token string">&quot;single-spa-vue&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span>

<span class="token comment">// 兼容写法，便于后面进行属于子应用或独立的写法</span>
<span class="token keyword">const</span> appOptions <span class="token operator">=</span> <span class="token punctuation">{</span>
  el<span class="token operator">:</span> <span class="token string">&quot;#vue&quot;</span><span class="token punctuation">,</span>
  <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token parameter">h</span> <span class="token operator">=&gt;</span> <span class="token function">h</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 但主应用引用自己的时候，会singleSpaNavigate这个字段，在这个时候我们需要设置webpackpublicppath为子应用的路径，否则主应用在操作子应用时，所进行涉及到请求的操作都会基于主应用自己的路径去执行，那样肯定会404</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>singleSpaNavigate<span class="token punctuation">)</span><span class="token punctuation">{</span>
  __webpack_public_path__ <span class="token operator">=</span> <span class="token string">&quot;http://localhost:8084/&quot;</span>
<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token comment">// 如果作为独立项目，就直接new</span>
  <span class="token keyword">delete</span> appOptions<span class="token punctuation">.</span>el<span class="token punctuation">;</span> <span class="token comment">// 删除掉没必要的键</span>
  <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span>appOptions<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token string">&quot;#app&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 生成子应用，返回值是对象，包含生命周期。</span>
<span class="token keyword">const</span> vueLifecycles <span class="token operator">=</span> <span class="token function">singleSpaVue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  Vue<span class="token punctuation">,</span>
  appOptions
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 导出生命周期对象，主要是为了给主应用使用。</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> bootstrap <span class="token operator">=</span> vueLifecycles<span class="token punctuation">.</span>bootstrap<span class="token punctuation">;</span> <span class="token comment">// 启动时</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> mount <span class="token operator">=</span> vueLifecycles<span class="token punctuation">.</span>mount<span class="token punctuation">;</span> <span class="token comment">// 挂载时</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> unmount <span class="token operator">=</span> vueLifecycles<span class="token punctuation">.</span>unmount<span class="token punctuation">;</span> <span class="token comment">// 卸载时</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> vueLifecycles<span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h4 id="第三步"><a href="#第三步" class="header-anchor">#</a> 第三步</h4> <p>webpack配置文件设置</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// vue.config.js</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@vue/cli-service'</span><span class="token punctuation">)</span>
<span class="token comment">// 一个方便我们导出打包数据的插件</span>
<span class="token keyword">const</span> StatsPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'stats-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  transpileDependencies<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  configureWebpack<span class="token operator">:</span><span class="token punctuation">{</span>
    output<span class="token operator">:</span> <span class="token punctuation">{</span>
      library<span class="token operator">:</span> <span class="token string">&quot;singleVue&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 生成的包名，也就是主应用在注册时需要用到的名字</span>
      libraryTarget<span class="token operator">:</span> <span class="token string">&quot;umd&quot;</span> <span class="token comment">// 生成的包为umd模块，特点是最终会将子应用生命周期对象给</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    devServer<span class="token operator">:</span><span class="token punctuation">{</span>
      port<span class="token operator">:</span> <span class="token number">8084</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token comment">// 生成一个mainfest.json，为了我们主应用使用时不需要将子应用的入口链接写死</span>
      <span class="token keyword">new</span> <span class="token class-name">StatsPlugin</span><span class="token punctuation">(</span><span class="token string">'manifest.json'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        chunkModules<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        entrypoints<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 因为我们的用途，只给输出的路径就好</span>
        source<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        chunks<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        modules<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        assets<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        children<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        exclude<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><h4 id="第四步"><a href="#第四步" class="header-anchor">#</a> 第四步</h4> <p>配置路由</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// router.js</span>
<span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span>
<span class="token keyword">import</span> VueRouter <span class="token keyword">from</span> <span class="token string">&quot;vue-router&quot;</span><span class="token punctuation">;</span>

Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>VueRouter<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> routes <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    path<span class="token operator">:</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span>
    <span class="token function-variable function">component</span><span class="token operator">:</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&quot;./components/aTest.vue&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    children<span class="token operator">:</span><span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
          path<span class="token operator">:</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span>
          <span class="token function-variable function">component</span><span class="token operator">:</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&quot;./components/aaTest.vue&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> routes<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>然后回到我们最开始的main.js，要对路由进行一点简单的处理。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// main.js</span>

<span class="token keyword">import</span> VueRouter <span class="token keyword">from</span> <span class="token string">&quot;vue-router&quot;</span>
<span class="token keyword">import</span> routes <span class="token keyword">from</span> <span class="token string">&quot;@/routes/routes.js&quot;</span>

<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VueRouter</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  mode<span class="token operator">:</span><span class="token string">&quot;history&quot;</span>
  routes<span class="token punctuation">,</span>
  <span class="token comment">// 设置base的话，hash模式其实不需要也可以，所以这里就用hisotry做例子。</span>
  base<span class="token operator">:</span> window<span class="token punctuation">.</span>singleSpaNavigate
  <span class="token operator">?</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">vue</span><span class="token regex-delimiter">/</span></span> <span class="token comment">// 如果被主应用调用，那么就给我们的基础路径以vue开头（这里不限于vue开头，任何xx开头都可以，主要是根据主应用设置要以什么开头来访问这个主应用）</span>
  <span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">&quot;production&quot;</span> <span class="token comment">// 如果没被主应用调用，然后还是生产环境，那就以...其实任意都行，看你线上想怎么部署</span>
  <span class="token operator">?</span> <span class="token string">&quot;app/vue&quot;</span>
  <span class="token operator">:</span>	<span class="token string">&quot;/&quot;</span>	<span class="token comment">// 都没命中，就默认路径好了</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> appOptions <span class="token operator">=</span> <span class="token punctuation">{</span>
  el<span class="token operator">:</span> <span class="token string">&quot;#vue&quot;</span><span class="token punctuation">,</span>
  router<span class="token punctuation">,</span>
  <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token parameter">h</span> <span class="token operator">=&gt;</span> <span class="token function">h</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// ....其余省略</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>说说为啥要这样，主要是在子页面里面路由调跳转的时候，我们不以设好的base来，就会导致我们按默认的路由去跳转是没加前缀，那样主应用就访问不到了。</p> <h4 id="小贴士"><a href="#小贴士" class="header-anchor">#</a> 小贴士</h4> <p>如果<code>__webpack_public_path__</code>设置被eslint警告出错的时候，可以尝试在package.json里面加上：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>  <span class="token property">&quot;eslintConfig&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;globals&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;__webpack_public_path__&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>至此，子应用构建完毕，接下来就是构建主应用了。</p> <h3 id="主应用构建"><a href="#主应用构建" class="header-anchor">#</a> 主应用构建</h3> <p>仍旧基于vue2</p> <h4 id="第一步-2"><a href="#第一步-2" class="header-anchor">#</a> 第一步</h4> <p>既然是主应用，那么就需要直接安装<code>single-spa</code>了。</p> <h4 id="第二步-2"><a href="#第二步-2" class="header-anchor">#</a> 第二步</h4> <p>入口文件配置</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// main.js</span>
<span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">&quot;./App.vue&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> registerApplication<span class="token punctuation">,</span> start <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;single-spa&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">&quot;axios&quot;</span>

<span class="token comment">// 注册子应用</span>
<span class="token function">registerApplication</span><span class="token punctuation">(</span>
	<span class="token string">&quot;singleVue&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 这里就是，我们当时在子应用配置的包名称</span>
  <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">// 这里面很关键，去读取在子应用打包出来的输出文件，将对应的生命周期对象去挂载到window上</span>
    <span class="token comment">// await loadScript('http://localhost:8084/js/chunk-vendors.js');</span>
    <span class="token comment">// await loadScript('http://localhost:8084/js/app.js');</span>
    <span class="token comment">// 最简单的做法，就是想我们上面这样去指定路径读取，但如果有的时候我们的输出文件不是这个名字就麻烦了，不够动态。那么，这里就要用到我们子应用导出的mainfest.json了。</span>
    <span class="token keyword">await</span> <span class="token function">getMainfest</span><span class="token punctuation">(</span><span class="token string">&quot;http://location:8080&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;/mainfeset.json&quot;</span><span class="token punctuation">,</span><span class="token string">'app'</span><span class="token punctuation">)</span> <span class="token comment">// 方法详细看下面</span>
    <span class="token keyword">return</span> window<span class="token punctuation">.</span>singleVue<span class="token punctuation">;</span>    
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token parameter">location</span> <span class="token operator">=&gt;</span> location<span class="token punctuation">.</span>pathname<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">&quot;/vue&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 设置，当路径开头是/vue的时候，去匹配这个子应用</span>
<span class="token punctuation">)</span>

<span class="token comment">// 根据链接生成script标签，植入到我们的页面当中</span>
<span class="token keyword">function</span> <span class="token function-variable function">loadScript</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res<span class="token punctuation">,</span>rej</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    script<span class="token punctuation">.</span>src <span class="token operator">=</span> url<span class="token punctuation">;</span>
    script<span class="token punctuation">.</span>onload <span class="token operator">=</span> res<span class="token punctuation">;</span>
    script<span class="token punctuation">.</span>onerror <span class="token operator">=</span> rej<span class="token punctuation">;</span>
    document<span class="token punctuation">.</span>head<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>sciprt<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 关系到单页面的运行，所以放在head后面</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 获取json里面对应的输出文件名，去组成链接，然后用loadScript去访问</span>
<span class="token keyword">function</span> <span class="token function">getMainfest</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span>path<span class="token punctuation">,</span>bundle</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> data <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>host<span class="token operator">+</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取mainfest.json内容</span>
  
  <span class="token keyword">const</span> <span class="token punctuation">{</span> entrypoints， publicPath <span class="token punctuation">}</span> <span class="token operator">=</span> data<span class="token punctuation">;</span> <span class="token comment">// 我们子应用的时候，配置要导出哪些，entryoptions就是我们输出文件相对路径</span>
  
  <span class="token keyword">const</span> assets <span class="token operator">=</span> entryoptions<span class="token punctuation">[</span>bundle<span class="token punctuation">]</span><span class="token punctuation">.</span>assets<span class="token punctuation">;</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> assets<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    	<span class="token comment">// 这里的.name，根据实际情况来,有时候不是在name里面</span>
    <span class="token keyword">await</span> <span class="token function">loadScript</span><span class="token punctuation">(</span>host <span class="token operator">+</span> publicPath <span class="token operator">+</span> assets<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>i <span class="token operator">===</span> assets<span class="token punctuation">.</span>length <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>

<span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 启动</span>

Vue<span class="token punctuation">.</span>config<span class="token punctuation">.</span>productionTip <span class="token operator">=</span> <span class="token boolean">false</span>

<span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token parameter">h</span> <span class="token operator">=&gt;</span> <span class="token function">h</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br></div></div><p>完工。</p> <p>这些都完成之后，依然存在我们之前提到的问题。因为single-spa并没有js和css的沙箱。</p> <h3 id="如何实现css隔离"><a href="#如何实现css隔离" class="header-anchor">#</a> 如何实现css隔离</h3> <h4 id="主应用和子应用之间的隔离"><a href="#主应用和子应用之间的隔离" class="header-anchor">#</a> 主应用和子应用之间的隔离</h4> <h5 id="沙箱思维-因为难度-推荐度一般"><a href="#沙箱思维-因为难度-推荐度一般" class="header-anchor">#</a> 沙箱思维（因为难度，推荐度一般）</h5> <p>这里就简单说明下会用到的技术，并不会去完整的实现。至于为什么，这正是single-spa上手难道高的原因之一。</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    沙箱外
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>沙箱外的span<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>shadow-outer<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>沙箱内<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">let</span> shadowOuterDOM <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;shadow-outer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attachShadow</span><span class="token punctuation">(</span><span class="token punctuation">{</span>mode<span class="token operator">:</span> <span class="token string">'closed'</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 拒绝从 js 外部访问关闭的 shadow root 节点</span>
    <span class="token keyword">let</span> spanEl <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;span&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    spanEl<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">&quot;沙箱内的span&quot;</span> 

    <span class="token keyword">let</span> styleEl <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;style&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    styleEl<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
      span { color:red }
    </span><span class="token template-punctuation string">`</span></span>
    shadowOuterDOM<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>styleEl<span class="token punctuation">)</span>
    shadowOuterDOM<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>spanEl<span class="token punctuation">)</span>

  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>这个方案实现了完全的css隔离，但有个缺点，那就是比如我们的子应用，有像是弹窗那种会挂在body上的，那样一来就属于沙箱外，没有样式了。</p> <h5 id="bem-推荐度比沙箱差一点"><a href="#bem-推荐度比沙箱差一点" class="header-anchor">#</a> BEM（推荐度比沙箱差一点）</h5> <p>约定不同项目的css前缀，这样就不会出现冲突或覆盖什么的了。</p> <h6 id="缺点-3"><a href="#缺点-3" class="header-anchor">#</a> 缺点</h6> <p>因为是约定，所以可以不遵守约定，有时候会出问题。（可以尝试，用eslit去检测约定）</p> <h5 id="css-modules-较推荐-因为容易"><a href="#css-modules-较推荐-因为容易" class="header-anchor">#</a> css-modules（较推荐，因为容易）</h5> <p>因为css-modules，会在打包时会将类名什么的转换，加上一些随机字符，也就不会生成冲突的选择器名</p> <h6 id="缺点-4"><a href="#缺点-4" class="header-anchor">#</a> 缺点</h6> <p>尽管如此，也有可能出现冲突的情况。</p> <h4 id="子应用之间的样式隔离"><a href="#子应用之间的样式隔离" class="header-anchor">#</a> 子应用之间的样式隔离</h4> <p>这个相对简单一点，思维就是建立一个动态样式表，子应用相互切换的时候，移除旧子应用样式，添加新子应用样式</p> <h5 id="快照沙箱"><a href="#快照沙箱" class="header-anchor">#</a> 快照沙箱</h5> <p>适合只有两个子应用的情况，如果有多个子应用的话只能使用代理沙箱</p> <h5 id="代理沙箱"><a href="#代理沙箱" class="header-anchor">#</a> 代理沙箱</h5> <p>多个子应用之间的情况。</p> <p><u>关于沙箱的具体实现，等有空再补充上。</u></p> <h2 id="qiankun"><a href="#qiankun" class="header-anchor">#</a> qiankun</h2> <p>既然single-spa那么麻烦，那想要让微前端正式流行起来，肯定就需要有人帮我们把single-spa封装，恰好qiankun就做了这么一件事，由蚂蚁金服推出。</p> <h3 id="优点-3"><a href="#优点-3" class="header-anchor">#</a> 优点</h3> <p>处理了single-spa的问题</p> <h3 id="缺点-5"><a href="#缺点-5" class="header-anchor">#</a> 缺点</h3> <p>还不够完美，子应用和主应用之间的修改和沟通成本随着子项目过多还是很麻烦</p> <p>qiankun使用的沙箱也不够完美，在实现上据说不够高效</p> <h3 id="子应用构建-2"><a href="#子应用构建-2" class="header-anchor">#</a> 子应用构建</h3> <h4 id="第一步-3"><a href="#第一步-3" class="header-anchor">#</a> 第一步</h4> <p>qiankun的子应用不再需要像single-spa那样去安装一个single-spa-xx，只要自己创建一下导出必要的函数就好</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// main.js</span>

<span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> VueRouter <span class="token keyword">from</span> <span class="token string">&quot;vue-router&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">&quot;./App.vue&quot;</span>
<span class="token keyword">import</span> router <span class="token keyword">from</span> <span class="token string">&quot;./router.js&quot;</span>

<span class="token keyword">let</span> instance <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// 用来将vue的实例保留起来，便于unmount的时候销毁。</span>

<span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">props <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> container <span class="token punctuation">}</span> <span class="token operator">=</span> props 
  instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    router<span class="token punctuation">,</span>
    <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token parameter">h</span> <span class="token operator">=&gt;</span> <span class="token function">h</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span>container <span class="token operator">?</span> container<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#app&quot;</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">&quot;#app&quot;</span><span class="token punctuation">)</span>
  <span class="token comment">// 因为如果被主应用引用了，那么我们身为子应用所在处是有自己的标签，关于我们的vue就得挂载到那个标签内id为app的元素里面。</span>
<span class="token punctuation">}</span>

<span class="token comment">// 如果被主应用调用了，就要去设置被引用的子应用内部所访问的资源链接，single-spa讲过</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>__POWERD_BY_QIANKUN__<span class="token punctuation">)</span><span class="token punctuation">{</span>
  __webpack_public_path__ <span class="token operator">=</span> window<span class="token punctuation">.</span>__INJECTED_PUBLIC_PATH_BY_QIANKUN__ <span class="token comment">// qiankun帮我们实现了动态去绑定该webpack的公共路径，不再像single-spa那样写死（ps：single-spa里面也可以写动态，自己封装一下就好）</span>
<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 单独运行，直接渲染就好。</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;子应用在主应用初始化时，只会被调用一次，一般在这里注册一些全局变量，不会被unmount清除掉那种&quot;</span><span class="token punctuation">,</span>props<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">mount</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">unmount</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  instance<span class="token punctuation">.</span><span class="token function">$destory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><h4 id="第二步-3"><a href="#第二步-3" class="header-anchor">#</a> 第二步</h4> <p>配置文件设置</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@vue/cli-service'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> packageName <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./package.json'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  transpileDependencies<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  devServer<span class="token operator">:</span><span class="token punctuation">{</span>
    port<span class="token operator">:</span> <span class="token number">8086</span><span class="token punctuation">,</span>
    headers<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;Access-Control-Allow-Origin&quot;</span><span class="token operator">:</span> <span class="token string">&quot;*&quot;</span> <span class="token comment">// 这里要将该项目设置为跨域，因为qiankun会直接读取我们的资源，主机不一样可能会跨域</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  configureWebpack<span class="token operator">:</span><span class="token punctuation">{</span>
    output<span class="token operator">:</span><span class="token punctuation">{</span>
      library<span class="token operator">:</span><span class="token string">&quot;qiankunVue&quot;</span><span class="token punctuation">,</span> <span class="token comment">// single-spa讲过</span>
      libraryTarget<span class="token operator">:</span><span class="token string">&quot;umd&quot;</span><span class="token punctuation">,</span>	<span class="token comment">// single-spa讲过</span>
      chunkLoadingGlobal<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">webpackJsonp_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="主应用构建-2"><a href="#主应用构建-2" class="header-anchor">#</a> 主应用构建</h3> <p>同样的，变得非常简单，就不分步骤了。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// main.js</span>

<span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">&quot;./App.vue&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> registerMicroApps<span class="token punctuation">,</span> start <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;qiankun&quot;</span><span class="token punctuation">;</span>

<span class="token function">registerMicroApps</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">&quot;qiankunVue&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 子应用名</span>
    entry<span class="token operator">:</span> <span class="token string">&quot;http://localhost:8086&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 我们原本去读取子应用输出文件的步骤，这里简化成只需要给基础链接就好了</span>
    container<span class="token operator">:</span> <span class="token string">&quot;#vue&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 挂载到指定的元素下</span>
    activeRule<span class="token operator">:</span> <span class="token string">&quot;/vue&quot;</span> <span class="token comment">// 原本的检测对应前缀才激活，不用自己去starsWith什么的了</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Vue<span class="token punctuation">.</span>config<span class="token punctuation">.</span>productionTip <span class="token operator">=</span> <span class="token boolean">false</span>

<span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token parameter">h</span> <span class="token operator">=&gt;</span> <span class="token function">h</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>然后呢，因为qiankun篇幅太少，就多写几个api好了</p> <h3 id="setdefaultmountapp"><a href="#setdefaultmountapp" class="header-anchor">#</a> setDefaultMountApp</h3> <p>用来设置主应用启动后的默认微应用，比如说，下面的代码，我们访问http://localhost:8083（主应用）会自动跳转成http://localhost:8083/vue</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> setDefaultMountApp <span class="token punctuation">}</span>  <span class="token keyword">from</span> <span class="token string">&quot;qiankun&quot;</span><span class="token punctuation">;</span>

<span class="token function">setDefaultMountApp</span><span class="token punctuation">(</span><span class="token string">&quot;/vue&quot;</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="initglobalstate"><a href="#initglobalstate" class="header-anchor">#</a> initGlobalState</h3> <p>定义全局状态，并返回通信方法。</p> <p>通常，会在主应用使用该方法，然后子应用通过props获取通信方法。</p> <blockquote><ul><li>返回
<ul><li>MicroAppStateActions
<ul><li>onGlobalStateChange: <code>(callback: OnGlobalStateChangeCallback, fireImmediately?: boolean) =&gt; void</code>， 在当前应用监听全局状态，有变更触发 callback，fireImmediately = true 立即触发 callback</li> <li>setGlobalState: <code>(state: Record&lt;string, any&gt;) =&gt; boolean</code>， 按一级属性设置全局状态，微应用中只能修改已存在的一级属性</li> <li>offGlobalStateChange: <code>() =&gt; boolean</code>，移除当前应用的状态监听，微应用 umount 时会默认调用</li></ul></li></ul></li></ul></blockquote> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 主应用main.js</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> initGlobalState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;qiankun&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> actions <span class="token operator">=</span> <span class="token function">initGlobalState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>a<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span>b<span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span>c<span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 注册主应用观察器</span>
actions<span class="token punctuation">.</span><span class="token function">onGlobalStateChange</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span>prev</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>  
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;主应用更新后的state：&quot;</span><span class="token punctuation">,</span>state<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;主应用更新前的state：&quot;</span><span class="token punctuation">,</span>prev<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

actions<span class="token punctuation">.</span><span class="token function">setGlocalState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>b<span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// actions.offGlobalStateChange(); // 平时不要用，因为unmount会自己调用。</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>在实际工作中，肯定不是像上面这么写的，我们应该另起一个js文件去维护这个全局状态，然后导出actins，在需要使用的页面去使用。</p> <p>**ps：**onGlobalStateChange在同个应用，重复监听会被覆盖。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 子应用main.js</span>

<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">mount</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
  props<span class="token punctuation">.</span><span class="token function">onGlobalStateChange</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> prev</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'子应用监听'</span><span class="token punctuation">,</span>state<span class="token punctuation">,</span>prev<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    props<span class="token punctuation">.</span><span class="token function">setGlobalState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>a<span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>子应用也一样，我的建议也是单独用一个js去维护actions，思路大概是用一个函数或类，将主应用传过来的actions当作参数传给这个函数或类。</p> <h2 id="micro-app"><a href="#micro-app" class="header-anchor">#</a> micro-app</h2> <p>在single-spa和qiankun中都是通过监听url change事件，而micro-app是借用了<code>类WebComponent</code>和<code>Html Entry</code>的思路。</p> <p>它在qiankun之上有了不小的提升，但沙箱那一套延用的还是qiankun那一套，过多的本篇文章就不多说了。</p> <h3 id="优点-4"><a href="#优点-4" class="header-anchor">#</a> 优点</h3> <p>更加精简了</p> <h3 id="缺点-6"><a href="#缺点-6" class="header-anchor">#</a> 缺点</h3> <p>还是不是沙箱的最终方案。</p> <p>支持vite，但需要使用额外的plugin去改造子应用，且js没法沙箱隔离。</p> <p>没有对不支持webcomponent的浏览器做降级处理。</p> <p>依然存在路由依赖，刷新依然会全部丢失。</p> <h3 id="主应用构建-3"><a href="#主应用构建-3" class="header-anchor">#</a> 主应用构建</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// main.js</span>

<span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App.vue'</span>
<span class="token keyword">import</span> microApp <span class="token keyword">from</span> <span class="token string">'@micro-zoe/micro-app'</span>

microApp<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 只需要启动一下。</span>

Vue<span class="token punctuation">.</span>config<span class="token punctuation">.</span>productionTip <span class="token operator">=</span> <span class="token boolean">false</span>

<span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token parameter">h</span> <span class="token operator">=&gt;</span> <span class="token function">h</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><div class="language-vue line-numbers-mode"><pre class="language-vue"><code><span class="token comment">&lt;!-- App.vue --&gt;</span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Vue logo<span class="token punctuation">&quot;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./assets/logo.png<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>micro-app</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vueapp<span class="token punctuation">&quot;</span></span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://localhost:8083/<span class="token punctuation">&quot;</span></span> <span class="token attr-name">baseurl</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/vue<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>micro-app</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>**baseurl：**就是设置自己在什么前缀访问子应用，并且，这也是传递给子应用的<code>__MICRO_APP_BASE_URL__</code>参数</p> <h3 id="子应用构建-3"><a href="#子应用构建-3" class="header-anchor">#</a> 子应用构建</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// main.js</span>

<span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App.vue'</span>
<span class="token keyword">import</span> VueRouter <span class="token keyword">from</span> <span class="token string">&quot;vue-router&quot;</span>

Vue<span class="token punctuation">.</span>config<span class="token punctuation">.</span>productionTip <span class="token operator">=</span> <span class="token boolean">false</span>

Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>VueRouter<span class="token punctuation">)</span>

<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VueRouter</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  mode<span class="token operator">:</span><span class="token string">&quot;hash&quot;</span><span class="token punctuation">,</span>
  routes<span class="token operator">:</span><span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        path<span class="token operator">:</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span>
        <span class="token function-variable function">component</span><span class="token operator">:</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&quot;./components/aTest.vue&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        children<span class="token operator">:</span><span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            path<span class="token operator">:</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span>
            <span class="token function-variable function">component</span><span class="token operator">:</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&quot;./components/aaTest.vue&quot;</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  base<span class="token operator">:</span>window<span class="token punctuation">.</span>__MICRO_APP_BASE_URL__ <span class="token operator">||</span> <span class="token string">'/'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>__MICRO_APP_ENVIRONMENT__<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  __webpack_public_path__ <span class="token operator">=</span> window<span class="token punctuation">.</span>__MICRO_APP_PUBLIC_PATH__
<span class="token punctuation">}</span> <span class="token comment">// 实测，就算没有了也没关系 </span>

 <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    router<span class="token punctuation">,</span>
    <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token parameter">h</span> <span class="token operator">=&gt;</span> <span class="token function">h</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token string">&quot;#app&quot;</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><p>仔细一看，其实什么都没处理，micro-app大大降低了我们对子应用的代码改动性，只需要兼容一下路由的<code>base</code>写法就好。</p> <p>**ps:**如果不同源记得支持跨域。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@vue/cli-service'</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  transpileDependencies<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  configureWebpack<span class="token operator">:</span><span class="token punctuation">{</span>
    devServer<span class="token operator">:</span><span class="token punctuation">{</span>
      headers<span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token string">&quot;Access-Control-Allow-Origin&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://localhost:8085&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>框架的使用越来越简单，用几个常用api来填充一下文章</p> <h3 id="数据通信"><a href="#数据通信" class="header-anchor">#</a> 数据通信</h3> <h4 id="主应用向子应用传递"><a href="#主应用向子应用传递" class="header-anchor">#</a> 主应用向子应用传递</h4> <h5 id="方法1"><a href="#方法1" class="header-anchor">#</a> 方法1</h5> <p>通过组件的<code>data</code>进行传参</p> <div class="language-vue line-numbers-mode"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>micro-app</span> <span class="token attr-name">:data</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{c:2,d:9}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vueapp<span class="token punctuation">&quot;</span></span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://localhost:8083/<span class="token punctuation">&quot;</span></span> <span class="token attr-name">baseurl</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/vue<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>micro-app</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="方法2"><a href="#方法2" class="header-anchor">#</a> 方法2</h5> <p>通过setData</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> microApp <span class="token keyword">from</span> <span class="token string">&quot;@micro-zoe/micro-app&quot;</span><span class="token punctuation">;</span>

mircroApp<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token string">&quot;vueapp&quot;</span><span class="token punctuation">,</span><span class="token punctuation">{</span>a<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span>b<span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 对应应用名称和传递的数据</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h5 id="adddatalistener"><a href="#adddatalistener" class="header-anchor">#</a> addDataListener</h5> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>window<span class="token punctuation">.</span>microApp<span class="token punctuation">.</span><span class="token function">addDataListener</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;子应用传来的数据：&quot;</span><span class="token punctuation">,</span>data<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 子应用被主应用使用之后，window上有microApp这个对象,接着子应用用监听或者主应用传过来的数据</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="子应用向主应用传递"><a href="#子应用向主应用传递" class="header-anchor">#</a> 子应用向主应用传递</h4> <h5 id="dispatch"><a href="#dispatch" class="header-anchor">#</a> dispatch</h5> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>window<span class="token punctuation">.</span>microApp<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>b<span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 子应用被主应用使用之后，window上有microApp这个对象，通过disptach将数据传给主应用</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="adddatalistener-2"><a href="#adddatalistener-2" class="header-anchor">#</a> addDataListener</h5> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> microApp <span class="token keyword">from</span> <span class="token string">&quot;@micro-zoe/micro-app&quot;</span><span class="token punctuation">;</span>

microApp<span class="token punctuation">.</span><span class="token function">addDataListener</span><span class="token punctuation">(</span><span class="token string">&quot;vueapp&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;子应用传来的数据：&quot;</span><span class="token punctuation">,</span>data<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 主应用需要使用该方法监听子应用传过来的数据</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>**Ps：**micro-app的监听不会被覆盖，可以监听多个</p> <h4 id="getdata"><a href="#getdata" class="header-anchor">#</a> getData</h4> <p>有了上面的基础，有些东西就不特别注释，这是个获取数据的方法，具体使用跟上面差不多</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//主应用</span>

<span class="token keyword">import</span> microApp <span class="token keyword">from</span> <span class="token string">&quot;@micro-zoe/micro-app&quot;</span><span class="token punctuation">;</span>

microApp<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token string">&quot;vueapp&quot;</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 子应用</span>

window<span class="token punctuation">.</span>microApp<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="removedatalistener"><a href="#removedatalistener" class="header-anchor">#</a> removeDataListener</h4> <p>跟removelistener一样，根据传进去的参数删除指定监听。</p> <h4 id="cleardtalistener"><a href="#cleardtalistener" class="header-anchor">#</a> clearDtaListener</h4> <p>删除所有监听器，全局监听器除外。</p> <h4 id="setglobaldata"><a href="#setglobaldata" class="header-anchor">#</a> setGlobalData</h4> <h4 id="getglocaldata"><a href="#getglocaldata" class="header-anchor">#</a> getGlocalData</h4> <h4 id="addglobaldatalistener"><a href="#addglobaldatalistener" class="header-anchor">#</a> addGlobalDataListener</h4> <h4 id="removeglobaldatalistener"><a href="#removeglobaldatalistener" class="header-anchor">#</a> removeGlobalDataListener</h4> <h4 id="clearglobaldatalistener"><a href="#clearglobaldatalistener" class="header-anchor">#</a> clearGlobalDatalistener</h4> <p>使用跟非全局的都差不多，就不翻译了，其余的api可看官网。</p> <p>**官网：**https://micro-zoe.github.io/micro-app/docs.html#/zh-cn/api</p> <h2 id="无界"><a href="#无界" class="header-anchor">#</a> 无界</h2> <p>前面提到的所有框架，他们都是自己去实现沙箱进行js的隔离，而无界不同，他将js放在iframe里面运行，而iframe本身就有强大的原生隔离能力。</p> <h3 id="优点-5"><a href="#优点-5" class="header-anchor">#</a> 优点</h3> <p>不再依赖路由。</p> <p>成本低、运行速度快、原生隔离、功能更加强大（子应用可以嵌套，保活、激活、共享，中心化通信，兼容ie9）</p> <p>特别是关于vite的，因为实现上更加原生，对vite的支持性也比其他框架要好。</p> <h3 id="核心方案"><a href="#核心方案" class="header-anchor">#</a> 核心方案</h3> <p>webcomponent + iframe沙箱</p> <h3 id="前言-3"><a href="#前言-3" class="header-anchor">#</a> 前言</h3> <p>随着框架越来越进步，使用也变得更加简单，详细的参数和api可以参考官网：https://wujie-micro.github.io/doc/</p> <h3 id="主应用构建-4"><a href="#主应用构建-4" class="header-anchor">#</a> 主应用构建</h3> <p>可以自己去直接使用wujie，但更推荐直接使用分装好的，也就是wujie-xxx这一类</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// main.js</span>

<span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App.vue'</span>
<span class="token keyword">import</span> wujieVue <span class="token keyword">from</span> <span class="token string">&quot;wujie-vue2&quot;</span>

Vue<span class="token punctuation">.</span>config<span class="token punctuation">.</span>productionTip <span class="token operator">=</span> <span class="token boolean">false</span>
Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>wujieVue<span class="token punctuation">)</span>
<span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token parameter">h</span> <span class="token operator">=&gt;</span> <span class="token function">h</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><div class="language-vue line-numbers-mode"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Vue logo<span class="token punctuation">&quot;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./assets/logo.png<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>WujieVue</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vueapp<span class="token punctuation">&quot;</span></span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://localhost:8085/<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>WujieVue</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="子应用构建-4"><a href="#子应用构建-4" class="header-anchor">#</a> 子应用构建</h3> <p>啥也不用干，必要的时候设置个跨域就好</p> <h3 id="关于wujie对框架的封装"><a href="#关于wujie对框架的封装" class="header-anchor">#</a> 关于wujie对框架的封装</h3> <p>以vue举例，他对vue的封装无非是，大概这个样子：</p> <blockquote><p>const WujieVue = vue3Flag ? defineComponent(wujieVueOptions) : Vue.extend(wujieVueOptions);</p> <p>WujieVue.setupApp = setupApp;
WujieVue.preloadApp = preloadApp;
WujieVue.bus = bus;
WujieVue.destroyApp = destroyApp;
WujieVue.install = function (Vue) {
Vue.component(&quot;WujieVue&quot;, WujieVue);
};</p> <p>export default WujieVue;</p></blockquote> <p>官方给出来的是这样，如果自己有些过参加，相信也很懂的吧。</p> <p>那么，因为无界的篇幅实在太少了，于是就，介绍下api那些好了，虽然官网写的很好了，但自己写一遍总归是能加深记忆。</p> <p>直接讲api过于枯燥，接下来就针对wujie对vue的封装来一边讲解api。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> wujie <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> bus<span class="token punctuation">,</span> setupApp<span class="token punctuation">,</span> startApp<span class="token punctuation">,</span> destroyApp <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;wujie&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createApp<span class="token punctuation">,</span> h<span class="token punctuation">,</span> defineComponent  <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> vue3Flag <span class="token operator">=</span> <span class="token operator">!</span><span class="token operator">!</span>createApp<span class="token punctuation">;</span> <span class="token comment">// 这里是针对vue3，他讲生成vue改成createApp，而不是直接整个去vue。</span>

<span class="token comment">// 虽然我们有方法，但我们还是更推荐给封装好的组件传递方法，所以需要自己处理一下。</span>

<span class="token keyword">const</span> wujieVueOptions <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">&quot;WujieVue&quot;</span><span class="token punctuation">,</span>
  props<span class="token operator">:</span> <span class="token punctuation">{</span>
	<span class="token operator">...</span><span class="token punctuation">.</span>省略
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      destroy<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// 用来接收，startApp的返回值</span>
      startAppQueue<span class="token operator">:</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 子应用启动队列</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    bus<span class="token punctuation">.</span><span class="token function">$onAll</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleEmit<span class="token punctuation">)</span> <span class="token comment">// 任何的emit都会触发到这个</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">execStartApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 调用我们自己封装的方法，启动子应用。</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$watch</span><span class="token punctuation">(</span>
      <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>url<span class="token punctuation">,</span>
      <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">execStartApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 简单理解，就是当我们的应用名称或者链接发生的变化的时候，重新启动新的子应用。</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  methods<span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token function">handleEmit</span><span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span><span class="token operator">...</span>args</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span><span class="token operator">...</span>args<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">execStartApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>startApp <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>startAppQueue<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
          <span class="token comment">// 启动子应用</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>destroy <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">startApp</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            name<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token comment">// 子应用名称</span>
            url<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>url<span class="token punctuation">,</span> <span class="token comment">// 子应用对应的链接</span>
            <span class="token comment">// html: this.html // 实际并没有，这里为了说明写一下，简单说就是有了它就不需要url，想用哪种方式渲染看自己</span>
            el<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>wujie<span class="token punctuation">,</span> <span class="token comment">// 子应用所要挂载的元素，</span>
            loading<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>loading<span class="token punctuation">,</span> <span class="token comment">// 子应用加载时要现实的loading原生（不是传布尔值而是元素！）</span>
            alive<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>alive<span class="token punctuation">,</span> <span class="token comment">// 是否开启自已子应用的存活状态，也就是state在切换之后不会消失</span>
            fetch<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>fetch<span class="token punctuation">,</span> <span class="token comment">// 自定义fetach接口，其实就是single-spa里面有说的，过于输出文件的js</span>
            props<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">,</span>  <span class="token comment">// 给子应用的数据</span>
            replace<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>replace<span class="token punctuation">,</span> <span class="token comment">// 直译是代码代替钩子，这个我不是很懂</span>
            sync<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sync<span class="token punctuation">,</span> <span class="token comment">// 路由同步开关</span>
            prefix<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>prefix<span class="token punctuation">,</span>
            fiber<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>fiber<span class="token punctuation">,</span>
            degrade<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>degrade<span class="token punctuation">,</span>
            plugins<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>plugins<span class="token punctuation">,</span> <span class="token comment">// 子应用插件</span>
            beforeLoad<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>beforeLoad<span class="token punctuation">,</span>
            beforeMount<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>beforeMount<span class="token punctuation">,</span>
            afterMount<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>afterMount<span class="token punctuation">,</span>
            beforeUnmount<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>beforeUnmount<span class="token punctuation">,</span>
            afterUnmount<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>afterUnmount<span class="token punctuation">,</span>
            activated<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>activated<span class="token punctuation">,</span>
            deactivated<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>deactivated<span class="token punctuation">,</span>
            loadError<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>loadError
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">beforeDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    bus<span class="token punctuation">.</span><span class="token function">$offAll</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleEmit<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">c</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> createElement <span class="token operator">=</span> vue3Flag <span class="token operator">?</span> h <span class="token operator">:</span> c<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      style<span class="token operator">:</span><span class="token punctuation">{</span>
        width<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>height<span class="token punctuation">,</span>
        height<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>height<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      ref<span class="token operator">:</span> <span class="token string">&quot;wujie&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> WujieVue <span class="token operator">=</span> vue3Flag <span class="token operator">?</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span>wujieVueOptions<span class="token punctuation">)</span> <span class="token operator">:</span> Vue<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span>wujieVueOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 小小科普一下，vue3要用defineCompopnent去定义组件，而vue2是同扩展方法。</span>

WujieVue<span class="token punctuation">.</span>setupApp <span class="token operator">=</span> setupApp<span class="token punctuation">;</span>
WujieVue<span class="token punctuation">.</span>preloadApp <span class="token operator">=</span> preloadApp<span class="token punctuation">;</span>
WujieVue<span class="token punctuation">.</span>bus <span class="token operator">=</span> bus<span class="token punctuation">;</span>
WujieVue<span class="token punctuation">.</span>destroyApp <span class="token operator">=</span> destroyApp<span class="token punctuation">;</span>
WujieVue<span class="token punctuation">.</span><span class="token function-variable function">install</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">Vue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">&quot;WujieVue&quot;</span><span class="token punctuation">,</span> WujieVue<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> WujieVue<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br></div></div><p>其实还挺简单的，无界本身就封装的很好了。</p> <h3 id="路由同步"><a href="#路由同步" class="header-anchor">#</a> 路由同步</h3> <p>如果试过上面去构建主应用和子应用，就会发现我们子应用在操作之后，刷新页面会子应用就会被重置，不会记录我们的子应用路由状态，所以需要开启路由同步。</p> <p>路由同步之后，主要是依靠我们的<code>?</code>后的参数</p> <div class="language-vue line-numbers-mode"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Vue logo<span class="token punctuation">&quot;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./assets/logo.png<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>WujieVue</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vueapp<span class="token punctuation">&quot;</span></span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://localhost:8085/<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:sync</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>WujieVue</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>设为true就好，这都是组件封装好了的，具体怎么传递的，看他对组件的封装就知道，其实就是在startApp的时候传递的。</p> <h3 id="在子应用上的键"><a href="#在子应用上的键" class="header-anchor">#</a> 在子应用上的键</h3> <p><code>window.$wujie</code></p> <h3 id="生命周期"><a href="#生命周期" class="header-anchor">#</a> 生命周期</h3> <p>看我们对vue封装里面的就知道有哪些了</p> <h3 id="通信"><a href="#通信" class="header-anchor">#</a> 通信</h3> <p>window通信，不建议</p> <p>props通信，挺好</p> <p>eventBus，也不错，介绍一下</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> wujieVue <span class="token keyword">from</span> <span class="token string">&quot;wujie-vue2&quot;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'App'</span><span class="token punctuation">,</span>
  <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    wujieVue<span class="token punctuation">.</span>bus<span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span><span class="token string">&quot;testyx&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">arg1<span class="token punctuation">,</span>arg2</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arg1<span class="token punctuation">,</span>arg2<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 子应用</span>

window<span class="token punctuation">.</span>$wujie<span class="token punctuation">.</span>bus<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">&quot;testyx&quot;</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>上面的eventBus的通信，其实并不适合帮我们封装好的vue版本，vue版本要这样使用setupApp</p> <p>设置子应用默认值</p> <div class="language-vue line-numbers-mode"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Vue logo<span class="token punctuation">&quot;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./assets/logo.png<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>WujieVue</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vueapp<span class="token punctuation">&quot;</span></span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://localhost:8085/<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:sync</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@testyx</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>testyx<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>WujieVue</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token comment">// import wujieVue from &quot;./wujieVue.js&quot;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'App'</span><span class="token punctuation">,</span>
  <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// wujieVue.bus.$on(&quot;testyx&quot;,(arg1,arg2)=&gt;{</span>
    <span class="token comment">//   console.log(arg1,arg2)</span>
    <span class="token comment">// })</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  methods<span class="token operator">:</span><span class="token punctuation">{</span> 
    <span class="token function">testyx</span><span class="token punctuation">(</span><span class="token parameter">arg1<span class="token punctuation">,</span>arg2</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arg1<span class="token punctuation">,</span>arg2<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h3 id="setupapp"><a href="#setupapp" class="header-anchor">#</a> setupApp</h3> <p>子应用启动的默认参数设置。</p></div></div> <div class="page-slot page-slot-bottom"><!-- 横向自适应 -->
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="6620245489"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/1059431281/edit/master/docs/web前端/18.微前端基本使用.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="tags"><a href="/tags/?tag=%E6%88%90%E9%95%BF" title="标签">#成长</a></div> <!----></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/417bb6/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">webpack常用插件使用</div></a> <a href="/pages/058b54/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">小程序小知识</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/417bb6/" class="prev">webpack常用插件使用</a></span> <span class="next"><a href="/pages/058b54/">小程序小知识</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/6997f1/"><div>NuxtImg跨平台打包教程</div></a> <span>06-27</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/2f367c/"><div>代码换行规则</div></a> <span>03-12</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/966b55/"><div>Stable Diffusion尝鲜</div></a> <span>10-27</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:894072666@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/1059431281" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=755597173" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2019-2025
    <span>雨宿り | <a href="https://github.com/xugaoyi/vuepress-theme-vdoing/blob/master/LICENSE" target="_blank">MIT License</a></span> <div id="jsi-flying-fish-container" class="container" style="  width: 100vw;\n  left: 0;\n  position: fixed;\n  bottom: 0;\nheight: 150px;\nmargin: 0;\npadding: 0;"></div> <div style="text-align:center;margin:50px 0; font:normal 14px/24px 'MicroSoft YaHei';"></div> <div class="container" style="  width: 100vw;\n  left: 0;\n  position: fixed;\n  bottom: 0;\nheight: 150px;\nmargin: 0;\npadding: 0;"></div></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">跟随系统</li><li class="iconfont icon-rijianmoshi">浅色模式</li><li class="iconfont icon-yejianmoshi">深色模式</li><li class="iconfont icon-yuedu">阅读模式</li></ul></div></div> <div class="body-bg" style="background:url() center center / cover no-repeat;opacity:0.5;"></div> <!----> <div class="custom-html-window custom-html-window-rb" style="display:;"><div class="custom-wrapper"><i class="close-but">×</i> <div><!-- 固定160*160px -->
      <ins class="adsbygoogle"
          style="display:inline-block;max-width:160px;max-height:160px"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="8377369658"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
      </div></div></div></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.7f8612d2.js" defer></script><script src="/assets/js/2.8f62c2a0.js" defer></script><script src="/assets/js/3.fbc0c9b3.js" defer></script><script src="/assets/js/41.1fab0bad.js" defer></script>
  </body>
</html>